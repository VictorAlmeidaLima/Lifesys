CREATE TRIGGER [sankhya].[TRG_INC_TGFPAR_CODEXT]
ON [sankhya].[TGFPAR]
FOR INSERT
AS
BEGIN


DECLARE @V_CODPARC INT,
		@V_TIPO VARCHAR(1),
		@V_LOGICO VARCHAR(1),
		@V_INTEIRO INT;

		SELECT
		@V_CODPARC = CODPARC,
		@V_TIPO = CLIENTE
		FROM INSERTED;

		SET @V_LOGICO = (SELECT LOGICO  FROM TSIPAR WHERE CHAVE = 'GERARCODEXTAUTO');

		SET @V_INTEIRO = (SELECT INTEIRO FROM TSIPAR WHERE CHAVE = 'ULTCODEXT');

		--Se o Par√¢metro estiver ligado.
		IF (@V_LOGICO = 'S')
		BEGIN

		--Se for Cliente.
			IF (@V_TIPO = 'S')
			BEGIN

				SET @V_INTEIRO = @V_INTEIRO + 1;

				UPDATE TGFPAR SET AD_CODEXT = @V_INTEIRO
				WHERE CODPARC = @V_CODPARC;

				UPDATE TSIPAR SET INTEIRO = @V_INTEIRO
				WHERE CHAVE = 'ULTCODEXT';

			END;

		END;


END




